{% extends 'soulstrader/base.html' %}

{% block title %}Profile - SOULTRADER{% endblock %}

{% block content %}
<div class="card">
    <h1 style="color: #667eea; margin-bottom: 1rem;">👤 Your Profile & Risk Settings</h1>
    <p style="color: #6c757d; margin-bottom: 2rem;">Manage your investment preferences, risk profile, and Smart Analysis settings.</p>
</div>

<!-- Basic Risk Profile -->
<div class="card">
    <h2 style="margin-bottom: 1.5rem; color: #333;">🎯 Basic Risk Profile</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem;">
        <div>
            <h4 style="color: #667eea; margin-bottom: 1rem;">Risk Level</h4>
            <div style="padding: 1rem; background-color: #f8f9fa; border-radius: 8px; border-left: 4px solid #667eea;">
                <div style="font-size: 1.2rem; font-weight: bold; color: #333; margin-bottom: 0.5rem;">
                    {{ profile.get_risk_level_display }}
                </div>
                <p style="color: #6c757d; margin: 0; font-size: 0.9rem;">
                    {% if profile.risk_level == 'CONSERVATIVE' %}
                        Focus on capital preservation with lower volatility investments.
                    {% elif profile.risk_level == 'MODERATE' %}
                        Balanced approach with moderate risk and return expectations.
                    {% else %}
                        Higher risk tolerance with focus on growth and higher returns.
                    {% endif %}
                </p>
            </div>
        </div>
        <div>
            <h4 style="color: #667eea; margin-bottom: 1rem;">Investment Goal</h4>
            <div style="padding: 1rem; background-color: #f8f9fa; border-radius: 8px; border-left: 4px solid #28a745;">
                <div style="font-size: 1.2rem; font-weight: bold; color: #333; margin-bottom: 0.5rem;">
                    {{ profile.get_investment_goal_display }}
                </div>
                <p style="color: #6c757d; margin: 0; font-size: 0.9rem;">
                    {% if profile.investment_goal == 'GROWTH' %}
                        Focus on capital appreciation and long-term growth.
                    {% elif profile.investment_goal == 'INCOME' %}
                        Prioritize dividend income and regular cash flow.
                    {% elif profile.investment_goal == 'PRESERVATION' %}
                        Emphasize capital preservation and low risk.
                    {% else %}
                        Balanced approach between growth and income.
                    {% endif %}
                </p>
            </div>
        </div>
        <div>
            <h4 style="color: #667eea; margin-bottom: 1rem;">Time Horizon</h4>
            <div style="padding: 1rem; background-color: #f8f9fa; border-radius: 8px; border-left: 4px solid #17a2b8;">
                <div style="font-size: 1.2rem; font-weight: bold; color: #333; margin-bottom: 0.5rem;">
                    {{ profile.get_time_horizon_display }}
                </div>
                <p style="color: #6c757d; margin: 0; font-size: 0.9rem;">
                    {% if profile.time_horizon == 'SHORT' %}
                        Investment timeline of 1-3 years.
                    {% elif profile.time_horizon == 'MEDIUM' %}
                        Investment timeline of 3-7 years.
                    {% else %}
                        Long-term investment timeline of 7+ years.
                    {% endif %}
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Smart Analysis Risk Settings -->
<div class="card">
    <h2 style="margin-bottom: 1.5rem; color: #333;">🧠 Smart Analysis Risk Settings</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
        
        <!-- Portfolio Optimization -->
        <div>
            <h4 style="color: #667eea; margin-bottom: 1rem;">Portfolio Optimization</h4>
            <div style="line-height: 1.8; padding: 1rem; background-color: #f8f9fa; border-radius: 8px;">
                <div><strong>Max Purchase %:</strong> {{ risk_profile.max_purchase_percentage }}% per stock</div>
                <div><strong>Min Confidence Score:</strong> {{ risk_profile.min_confidence_score }}/1.00</div>
                <div><strong>Cash Spend %:</strong> {{ risk_profile.cash_spend_percentage }}% of available cash</div>
                <div><strong>Max Sector Allocation:</strong> {{ risk_profile.max_sector_allocation }}% per sector</div>
                <div><strong>Min Diversification:</strong> {{ risk_profile.min_diversification_stocks }} stocks minimum</div>
            </div>
        </div>

        <!-- Anti-Repetition Rules -->
        <div>
            <h4 style="color: #667eea; margin-bottom: 1rem;">Anti-Repetition Rules</h4>
            <div style="line-height: 1.8; padding: 1rem; background-color: #f8f9fa; border-radius: 8px;">
                <div><strong>Cooldown Period:</strong> {{ risk_profile.cooldown_period_days }} days between same stock</div>
                <div><strong>Max Rebuy %:</strong> {{ risk_profile.max_rebuy_percentage }}% of existing position</div>
            </div>
        </div>

        <!-- Stock Filtering -->
        <div>
            <h4 style="color: #667eea; margin-bottom: 1rem;">Stock Filtering</h4>
            <div style="line-height: 1.8; padding: 1rem; background-color: #f8f9fa; border-radius: 8px;">
                <div><strong>Allow Penny Stocks:</strong> 
                    {% if risk_profile.allow_penny_stocks %}
                        <span style="color: #28a745; font-weight: bold;">Yes</span>
                    {% else %}
                        <span style="color: #dc3545; font-weight: bold;">No</span>
                    {% endif %}
                </div>
                <div><strong>Min Stock Price:</strong> ${{ risk_profile.min_stock_price }}</div>
                <div><strong>Min Market Cap:</strong> ${{ risk_profile.min_market_cap|floatformat:0 }}</div>
            </div>
        </div>

    </div>
</div>

<!-- Portfolio Settings -->
<div class="card">
    <h2 style="margin-bottom: 1.5rem; color: #333;">💼 Portfolio Settings</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem;">
        <div>
            <h4 style="color: #667eea; margin-bottom: 1rem;">Capital Management</h4>
            <div style="line-height: 1.8; padding: 1rem; background-color: #f8f9fa; border-radius: 8px;">
                <div><strong>Initial Capital:</strong> ${{ portfolio.initial_capital|floatformat:2 }}</div>
                <div><strong>Current Capital:</strong> ${{ portfolio.current_capital|floatformat:2 }}</div>
                <div><strong>Total Invested:</strong> ${{ portfolio.total_invested|floatformat:2 }}</div>
                <div><strong>Available Cash:</strong> ${{ portfolio.current_capital|floatformat:2 }}</div>
            </div>
        </div>
        <div>
            <h4 style="color: #667eea; margin-bottom: 1rem;">Portfolio Limits</h4>
            <div style="line-height: 1.8; padding: 1rem; background-color: #f8f9fa; border-radius: 8px;">
                <div><strong>Max Positions:</strong> {{ profile.max_positions }} stocks</div>
                <div><strong>Max Position Size:</strong> {{ profile.max_position_size }}% per stock</div>
                <div><strong>Auto Rebalance:</strong> 
                    {% if portfolio.auto_rebalance %}
                        <span style="color: #28a745; font-weight: bold;">Enabled</span>
                    {% else %}
                        <span style="color: #6c757d;">Disabled</span>
                    {% endif %}
                </div>
                <div><strong>Rebalance Frequency:</strong> {{ portfolio.get_rebalance_frequency_display }}</div>
            </div>
        </div>
        <div>
            <h4 style="color: #667eea; margin-bottom: 1rem;">Investment Preferences</h4>
            <div style="line-height: 1.8; padding: 1rem; background-color: #f8f9fa; border-radius: 8px;">
                <div><strong>Preferred Market Cap:</strong> {{ profile.get_preferred_market_cap_display }}</div>
                <div><strong>ESG Focused:</strong> 
                    {% if profile.esg_focused %}
                        <span style="color: #28a745; font-weight: bold;">Yes</span>
                    {% else %}
                        <span style="color: #6c757d;">No</span>
                    {% endif %}
                </div>
                {% if profile.esg_focused %}
                    <div><strong>Min ESG Score:</strong> {{ profile.esg_score_minimum|floatformat:1 }}/10</div>
                {% endif %}
                {% if profile.preferred_sectors %}
                    <div><strong>Preferred Sectors:</strong></div>
                    <div style="margin-left: 1rem; color: #6c757d;">
                        {% for sector in profile.preferred_sectors %}
                            • {{ sector }}<br>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Risk Assessment Results -->
{% if risk_assessment %}
<div class="card">
    <h2 style="margin-bottom: 1.5rem; color: #333;">📊 Risk Assessment Results</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
        <div style="background: white; border: 1px solid #e9ecef; border-radius: 8px; padding: 1rem; text-align: center;">
            <div style="font-size: 2rem; font-weight: bold; color: #667eea; margin-bottom: 0.5rem;">{{ risk_assessment.risk_score|floatformat:1 }}</div>
            <div style="color: #6c757d;">Risk Score</div>
        </div>
        <div style="background: white; border: 1px solid #e9ecef; border-radius: 8px; padding: 1rem; text-align: center;">
            <div style="font-size: 2rem; font-weight: bold; color: #17a2b8; margin-bottom: 0.5rem;">{{ risk_assessment.age }}</div>
            <div style="color: #6c757d;">Age</div>
        </div>
        <div style="background: white; border: 1px solid #e9ecef; border-radius: 8px; padding: 1rem; text-align: center;">
            <div style="font-size: 2rem; font-weight: bold; color: #28a745; margin-bottom: 0.5rem;">{{ risk_assessment.investment_experience }}</div>
            <div style="color: #6c757d;">Experience (0-10)</div>
        </div>
        <div style="background: white; border: 1px solid #e9ecef; border-radius: 8px; padding: 1rem; text-align: center;">
            <div style="font-size: 2rem; font-weight: bold; color: #ffc107; margin-bottom: 0.5rem;">{{ risk_assessment.risk_tolerance }}</div>
            <div style="color: #6c757d;">Risk Tolerance (0-10)</div>
        </div>
    </div>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem;">
        <div>
            <h4 style="color: #667eea; margin-bottom: 1rem;">Assessment Details</h4>
            <div style="line-height: 1.8; padding: 1rem; background-color: #f8f9fa; border-radius: 8px;">
                <div><strong>Volatility Comfort:</strong> {{ risk_assessment.volatility_comfort }}/10</div>
                <div><strong>Loss Tolerance:</strong> {{ risk_assessment.loss_tolerance }}/10</div>
                <div><strong>Recommended Level:</strong> {{ risk_assessment.get_recommended_risk_level_display }}</div>
                <div><strong>Completed:</strong> {{ risk_assessment.completed_at|date:"M d, Y" }}</div>
            </div>
        </div>
        <div>
            <h4 style="color: #667eea; margin-bottom: 1rem;">Risk Profile Match</h4>
            <div style="padding: 1rem; background-color: #f8f9fa; border-radius: 8px;">
                {% if profile.risk_level == risk_assessment.recommended_risk_level %}
                    <div style="color: #28a745; font-weight: bold; margin-bottom: 0.5rem;">✅ Perfect Match</div>
                    <p style="color: #6c757d; margin: 0; font-size: 0.9rem;">
                        Your current risk level matches the recommended level from your assessment.
                    </p>
                {% else %}
                    <div style="color: #ffc107; font-weight: bold; margin-bottom: 0.5rem;">⚠️ Consider Adjusting</div>
                    <p style="color: #6c757d; margin: 0; font-size: 0.9rem;">
                        Your current risk level ({{ profile.get_risk_level_display }}) differs from the recommended level ({{ risk_assessment.get_recommended_risk_level_display }}).
                    </p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% else %}
<div class="card">
    <h2 style="margin-bottom: 1.5rem; color: #333;">📊 Risk Assessment</h2>
    <div style="text-align: center; padding: 2rem; color: #6c757d;">
        <h3 style="margin-bottom: 1rem;">Complete Your Risk Assessment</h3>
        <p style="margin-bottom: 2rem;">Take our risk assessment questionnaire to get personalized recommendations based on your risk tolerance and investment goals.</p>
        <button class="btn" style="background-color: #17a2b8;">Take Risk Assessment</button>
    </div>
</div>
{% endif %}

<!-- Notification Preferences -->
<div class="card">
    <h2 style="margin-bottom: 1.5rem; color: #333;">🔔 Notification Preferences</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem;">
        <div>
            <h4 style="color: #667eea; margin-bottom: 1rem;">Communication Channels</h4>
            <div style="line-height: 1.8; padding: 1rem; background-color: #f8f9fa; border-radius: 8px;">
                <div><strong>Email Notifications:</strong> 
                    {% if profile.email_notifications %}
                        <span style="color: #28a745; font-weight: bold;">Enabled</span>
                    {% else %}
                        <span style="color: #6c757d;">Disabled</span>
                    {% endif %}
                </div>
                <div><strong>SMS Notifications:</strong> 
                    {% if profile.sms_notifications %}
                        <span style="color: #28a745; font-weight: bold;">Enabled</span>
                    {% else %}
                        <span style="color: #6c757d;">Disabled</span>
                    {% endif %}
                </div>
            </div>
        </div>
        <div>
            <h4 style="color: #667eea; margin-bottom: 1rem;">Notification Types</h4>
            <div style="line-height: 1.8; padding: 1rem; background-color: #f8f9fa; border-radius: 8px;">
                <div><strong>Daily Summary:</strong> 
                    {% if profile.daily_summary %}
                        <span style="color: #28a745; font-weight: bold;">Enabled</span>
                    {% else %}
                        <span style="color: #6c757d;">Disabled</span>
                    {% endif %}
                </div>
                <div><strong>Recommendation Alerts:</strong> 
                    {% if profile.recommendation_alerts %}
                        <span style="color: #28a745; font-weight: bold;">Enabled</span>
                    {% else %}
                        <span style="color: #6c757d;">Disabled</span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Account Information -->
<div class="card">
    <h2 style="margin-bottom: 1.5rem; color: #333;">👤 Account Information</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem;">
        <div>
            <h4 style="color: #667eea; margin-bottom: 1rem;">Profile Details</h4>
            <div style="line-height: 1.8; padding: 1rem; background-color: #f8f9fa; border-radius: 8px;">
                <div><strong>Username:</strong> {{ user.username }}</div>
                <div><strong>Email:</strong> {{ user.email|default:"Not provided" }}</div>
                <div><strong>Name:</strong> {{ user.first_name }} {{ user.last_name }}</div>
                <div><strong>Member Since:</strong> {{ user.date_joined|date:"M d, Y" }}</div>
            </div>
        </div>
        <div>
            <h4 style="color: #667eea; margin-bottom: 1rem;">Profile Status</h4>
            <div style="line-height: 1.8; padding: 1rem; background-color: #f8f9fa; border-radius: 8px;">
                <div><strong>Profile Created:</strong> {{ profile.created_at|date:"M d, Y" }}</div>
                <div><strong>Last Updated:</strong> {{ profile.updated_at|date:"M d, Y H:i" }}</div>
                <div><strong>Status:</strong> <span style="color: #28a745; font-weight: bold;">Active</span></div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="card">
    <h2 style="margin-bottom: 1.5rem; color: #333;">⚡ Quick Actions</h2>
    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
        <button class="btn">Edit Profile</button>
        <button class="btn btn-secondary">Change Password</button>
        {% if not risk_assessment %}
            <button class="btn" style="background-color: #17a2b8;">Take Risk Assessment</button>
        {% else %}
            <button class="btn" style="background-color: #17a2b8;">Retake Assessment</button>
        {% endif %}
        <button class="btn" style="background-color: #6f42c1;">Export Data</button>
        <a href="{% url 'soulstrader:dashboard' %}" class="btn btn-secondary">Back to Dashboard</a>
    </div>
</div>
{% endblock %}